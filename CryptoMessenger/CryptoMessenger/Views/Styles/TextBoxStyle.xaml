<ResourceDictionary 
    x:Class="CryptoMessenger.Views.Styles.TextBoxStyle"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:CryptoMessenger.Views.Styles"
    >

    <!-- brushes -->
    <SolidColorBrush x:Key="TextBoxBorderBrush" Color="White" />
    <SolidColorBrush x:Key="FocusedTextBoxBorderBrush" Color="White" />
    <SolidColorBrush x:Key="SelectionBrush" Color="Gray" />

    <!-- textbox style -->
    <Style x:Key="TextBoxStyle" TargetType="{x:Type TextBox}">
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type TextBox}">
                    <Grid>
                        <Border
                            x:Name="textBoxBorder"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{DynamicResource TextBoxBorderBrush}"
                            BorderThickness="1"
                            Padding="0"
                            />
                        <Grid Margin="5">
                            <!-- text -->
                            <TextBox 
                                    x:Name="textSource"
                                    Text="{Binding Path=Text,
                                        RelativeSource={RelativeSource TemplatedParent}, 
                                        Mode=TwoWay,
                                        UpdateSourceTrigger=PropertyChanged}"
                                    BorderThickness="0" 
                                    SelectionBrush="{DynamicResource SelectionBrush}" 
                                    SelectionOpacity="0.5"
                                    Background="Transparent" 
                                    Panel.ZIndex="2" 
                                    TextOptions.TextRenderingMode="ClearType"
                                    TextOptions.TextFormattingMode="Display"
                                    MaxLength="{Binding Path=MaxLength,
                                                RelativeSource={RelativeSource TemplatedParent}, 
                                                Mode=OneWay}"
                                    />
                            <!-- placeholder -->
                            <TextBox Text="{TemplateBinding Tag}" 
                                    Background="{TemplateBinding Background}" 
                                    Panel.ZIndex="1"
                                    BorderThickness="0"
                                    TextOptions.TextRenderingMode="ClearType"
                                    TextOptions.TextFormattingMode="Display"
                                    IsTabStop="False"
                                    >
                                <TextBox.Style>
                                    <Style TargetType="{x:Type TextBox}">
                                        <Setter Property="Foreground" Value="Transparent" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Path=Text, Source={x:Reference textSource}}" Value="" >
                                                <Setter Property="Foreground" Value="LightGray" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBox.Style>
                            </TextBox>
                        </Grid>
                    </Grid>
                    <!-- textbox got focus -->
                    <ControlTemplate.Triggers>
                        <DataTrigger Binding="{Binding IsFocused, ElementName=textSource}" Value="true">
                            <Setter TargetName="textBoxBorder" 
                                    Property="BorderBrush" 
                                    Value="{DynamicResource FocusedTextBoxBorderBrush}"
                                    />
                        </DataTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>
    